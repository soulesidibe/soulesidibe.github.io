<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44424399-2', 'soulesidibe.github.io');
  ga('send', 'pageview');

</script>
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Soulesidibe &middot; An android enthusiast
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <div class="container content">
      <div class="masthead">
       <h3 class="masthead-title">
    <a href="/" title="Home">Soulesidibe</a>

    
      &nbsp;&nbsp;&nbsp;
      <small><a href="/about">About</a></small>
    
      &nbsp;&nbsp;&nbsp;
      <small><a href="/archive">Archive</a></small>
    
      &nbsp;&nbsp;&nbsp;
      <small><a href="/atom.xml">Feed</a></small>
    
    </h3>
      </div>

      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2012/12/08/Android-Consommer-un-web-service/">
        Android:Consommer un web service
      </a>
    </h1>

    <span class="post-date">08 Dec 2012</span>

    <p>Je vais vous parler de comment se fait la consommation de web services dans une application android. 
Pourquoi android? Deux raisons me pousse à parler des services sous cette plateforme mobile: </p>

<ul>
<li>La presque totalité des jeunes étudiants fraîchement sortis de nos écoles d’informatique a eu à suivre un 
programme sur le développement avec le langage java (le langage de choix des profs pour appliquer les 
concepts de l’orienté objet). Et c’est se même langage qui est utilisé pour le développement sous android. </li>
<li>Parmi les plateformes mobiles à la mode, android offre une accessibilité &quot;bon marché&quot;: 12.OOOFCFA ($25) 
pour avoir un compte développeur à vie, et les outils de développement sont accessible sur tous les systèmes 
d’exploitation et gratuitement. </li>
</ul>

<p>Avant de rentrer dans le vif du sujet, il est bon se mettre dans un contexte où utiliser des web 
services devient essentiel! Imaginons que vous avez développer une application (desktop, web ou autre) 
qui a fait le buzz! Et tout vas pour le mieux :-). Mais à un moment donné, vous vous rendez compte que votre 
application devrait pouvoir être utilisé pas que quand on est devant un PC. Et là vous commencez à penser à 
une application mobile sur les différentes plateforme star à savoir Android, IOS et Windows phone.</p>

<p>Un autre problème se pose. Comment allez vous faire pour mettre toute la logique de votre killer app dans 
un smartphone! déjà qu’il faudra une version par système d’exploitation, si on doit porter toute la logique 
sur chaque langage de programmation(java, objective-C, C#), bonjour la galère! </p>

<p>Vous l’avez devenez! La solution c’est de garder la logique métier côté serveur et que chaque client
(mobile, web, desktop) fasse des appels quand il a besoin d’une ressource spécifique. Les web services REST 
sont une très bonne alternative pour mettre en place ce genre de technique.  Pas besoin d’une implémentation 
par langage; tous les clients utiliseront le protocole http pour communiquer avec les serveurs. Ce qui simplifie 
grandement les échanges entres les différentes entités. </p>

<p>(La gestion des exceptions et certaines initialisations de variable ont été volontairement omises.) </p>

<h2>Faire un appel</h2>

<p>Pour faire un appel vu que REST est orienté web, on va utiliser les classes du package java.net. On crée un objet 
de type URL qui va contenir l’adresse de la ressource ou tout simplement le lien du service: </p>

<div class="highlight"><pre><code class="java"><span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://chemin/vers/service&quot;</span><span class="o">);</span>
</code></pre></div>

<p>On ouvre une connexion</p>

<div class="highlight"><pre><code class="java"><span class="n">URLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
<span class="n">HttpURLConnection</span> <span class="n">httpConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">connection</span><span class="o">;</span>
</code></pre></div>

<p>Récupération du code de retour. Vu qu’on est en HTTP. Si tout c’est bien passé on doit recevoir le code 200 (ici HttpURLConnection.HTTP_OK) et enfin récupérer notre flux:</p>

<div class="highlight"><pre><code class="java"><span class="kt">int</span> <span class="n">responseCode</span> <span class="o">=</span> <span class="n">httpConnection</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">responseCode</span> <span class="o">==</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">in</span> <span class="o">=</span> <span class="n">httpConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>

<p>A ce stade nous avons un objet de type InputStream qui contient les informations que le serveur a renvoyé.</p>

<h2>Parser du xml avec XMLPullParser</h2>

<p>Apres la récupération des données il faut bien les lires. 
Pour cela il faudra utiliser un parseur en fonction de la techno utiliser pour envoyer les données côté serveur. 
Dans le cas du xml, il existe un parseur natif intégrer à Android: XMLPullParser. C’est un parseur bas niveau; 
c’est a dire qu’il faudra parcourir tout le document xml, tag par tag et faire des traitements en fonction du tag 
rencontré. Voici un exemple de xml que l’on peut recevoir: </p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;personnes&gt;</span>
   <span class="nt">&lt;personne</span> <span class="na">genre=</span><span class="s">&quot;feminin&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;nom&gt;</span>Diallo<span class="nt">&lt;/nom&gt;</span>
      <span class="nt">&lt;prenom&gt;</span>Binta<span class="nt">&lt;/prenom&gt;</span>
      <span class="nt">&lt;age&gt;</span>15<span class="nt">&lt;/age&gt;</span>
   <span class="nt">&lt;/personne&gt;</span>
   <span class="nt">&lt;personne</span> <span class="na">genre=</span><span class="s">&quot;masculin&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;nom&gt;</span>Ndiaye<span class="nt">&lt;/nom&gt;</span>
      <span class="nt">&lt;prenom&gt;</span>Alioune<span class="nt">&lt;/prenom&gt;</span>
      <span class="nt">&lt;age&gt;</span>25<span class="nt">&lt;/age&gt;</span>
   <span class="nt">&lt;/personne&gt;</span>
<span class="nt">&lt;/personnes&gt;</span>
</code></pre></div>
 

<p>On aura besoin d’un objet String pour contenir la valeur d’un tag à chaque passage., un objet qui va nous 
fournir un parseur qui aura les paramètres indiqués( ici le support des espaces de noms, voir doc de <strong>XmlPullParserFactory</strong>), 
Et enfin générer notre parseur et lui spécifier l’objet InputStream avec lequel il devra travailler: </p>

<div class="highlight"><pre><code class="java"><span class="n">String</span> <span class="n">valeur</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">XmlPullParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">XmlPullParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setNamespaceAware</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">XmlPullParser</span> <span class="n">xpp</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newPullParser</span><span class="o">();</span>
<span class="n">xpp</span><span class="o">.</span><span class="na">setInput</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</code></pre></div>
 

<p>Voici un morceau de code tiré de la doc officiel qu’on peut utiliser pour extraire les informations du InputStream: </p>

<div class="highlight"><pre><code class="java"><span class="c1">//Le type d&#39;evenement pour savoir si on est au debut du xml et bien </span>
<span class="c1">//d&#39;autres informations</span>
<span class="kt">int</span> <span class="n">eventType</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getEventType</span><span class="o">();</span>
<span class="c1">//Tant qu&#39;on n&#39;est pas à la fin du document</span>
<span class="k">while</span> <span class="o">(</span><span class="n">eventType</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_DOCUMENT</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">//Si on est au debut d&#39;un tag</span>
   <span class="k">if</span><span class="o">(</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;personne&quot;</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">genre</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getAttributeValue</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;genre&quot;</span><span class="o">);</span>
      <span class="o">}</span>
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;nom&quot;</span><span class="o">)){</span>
         <span class="n">nom</span> <span class="o">=</span> <span class="n">valeur</span><span class="o">;</span>
         <span class="n">valeur</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span> 
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">TEXT</span><span class="o">)</span> <span class="o">{</span>
       <span class="c1">//recuperation de la valeur pour le tag actuel</span>
       <span class="n">valeur</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
   <span class="o">}</span>
   <span class="n">eventType</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
 

<p>Une petite astuce que vous avez surement remarqué, en début de tag on récupére les attributs du tag, en fin de 
tag on récupère la valeur pour ce tag. 
Un exemple concret sur ce parseur sur <a href="https://github.com/soulesidibe/xmlPullParserExemple">github</a>. </p>

<h2>Manipuler du json</h2>

<p>Pour traiter du json reçu via un web service, Android embarque en natif un package constituer de classe 
pour faire le job: <strong>org.json.</strong>* .Elles sont très simples d’utilisation. Voyons ce cas pratique de json: </p>

<div class="highlight"><pre><code class="json"><span class="p">{</span>
   <span class="nt">&quot;personnes&quot;</span><span class="p">:[</span>
      <span class="p">{</span>
         <span class="nt">&quot;nom&quot;</span><span class="p">:</span><span class="s2">&quot;Fama&quot;</span><span class="p">,</span>         
         <span class="nt">&quot;prenom&quot;</span><span class="p">:</span><span class="s2">&quot;Mbaye&quot;</span><span class="p">,</span>         
         <span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="s2">&quot;19&quot;</span><span class="p">,</span>        
         <span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="s2">&quot;feminin&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="nt">&quot;nom&quot;</span><span class="p">:</span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span>
         <span class="nt">&quot;prenom&quot;</span><span class="p">:</span><span class="s2">&quot;Anthoine&quot;</span><span class="p">,</span>
         <span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="s2">&quot;30&quot;</span><span class="p">,</span>
         <span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="s2">&quot;masculin&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
 

<p>Le code pour récupérer les informations ci-dessus: </p>

<div class="highlight"><pre><code class="java"><span class="c1">//Convertir le InputStream de départ en String</span>
<span class="n">BufferedReader</span> <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">InputStreamReader</span><span class="o">(</span><span class="n">in</span><span class="o">));</span>
<span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
<span class="n">String</span> <span class="n">uneLigneLue</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
<span class="k">while</span> <span class="o">(</span><span class="n">uneLigneLue</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">//on ajoute la nouvelle ligne lue dans le StringBuilder</span>
   <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">UneLigneLue</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>
   <span class="c1">//lecture de la ligne suivante</span>
   <span class="n">ligneLue</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span> 
<span class="o">}</span>
<span class="n">bufferedReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

<span class="c1">//notre Objet maguique</span>
<span class="n">JSONObject</span> <span class="n">object</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">stringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="n">JSONArray</span> <span class="n">array</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">&quot;personnes&quot;</span><span class="o">);</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
    <span class="n">nom</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;nom&quot;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div>
 

<p>Un cas concret de manipulation du json sur <a href="https://github.com/soulesidibe/JsonParserExemple">github</a>. </p>

<p>Cette facon de faire est pratique pour des fichiers aussi simple que celui utilisé mais il est mieux dans 
certains cas d’opter pour des librairies qui ajoutent un niveau d’abstraction dans un souci de simplifier 
la manipulation du json. C’est le cas de la librairie <strong>GSON</strong> qui permet de faire le passage du JSON en <strong>POJO</strong> 
et vice versa.  Il y a aussi la librairie <strong>JACKSON</strong> tout aussi puissante. 
Il faut juste choisir celle qui nous rend efficace. </p>

<h2>Oui mais pourquoi faire?</h2>

<p>Apres avoir reçu les données du serveur, après avoir convertir le xml/json en objet java, en tant que 
dévelopeur java, il n’y a pas vraiment de limite! 
Dans le contexte d’un développement android, il y a plusieurs manières d’utiliser ces données: </p>

<ul>
<li>Mettre à jour une liste: exemple une vue qui affiche la timeline d’un compte twitter a besoin de récupérer 
les informations des serveurs de twitter pour les exposer à l’utilisateur via une ListView ou une ListActivity;</li>
<li>Renseigner une base de données (sqlite) pour une utilisation de l’application en offline </li>
</ul>

<p>Les possibilités n’ont pas de limite. Ça dépendra de ce que l’application fait et de comment 
le développeur veut le faire.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page8">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page6">Newer</a>
    
  
</div>

<!-- 

  <h1><a href="/2012/12/08/Android-Consommer-un-web-service/">Android:Consommer un web service</a></h1>
  <p class="author">
    <span class="date">2012-12-08 00:00:00 +0000</span>
  </p>
  <div class="content">
    <p>Je vais vous parler de comment se fait la consommation de web services dans une application android. 
Pourquoi android? Deux raisons me pousse à parler des services sous cette plateforme mobile: </p>

<ul>
<li>La presque totalité des jeunes étudiants fraîchement sortis de nos écoles d’informatique a eu à suivre un 
programme sur le développement avec le langage java (le langage de choix des profs pour appliquer les 
concepts de l’orienté objet). Et c’est se même langage qui est utilisé pour le développement sous android. </li>
<li>Parmi les plateformes mobiles à la mode, android offre une accessibilité &quot;bon marché&quot;: 12.OOOFCFA ($25) 
pour avoir un compte développeur à vie, et les outils de développement sont accessible sur tous les systèmes 
d’exploitation et gratuitement. </li>
</ul>

<p>Avant de rentrer dans le vif du sujet, il est bon se mettre dans un contexte où utiliser des web 
services devient essentiel! Imaginons que vous avez développer une application (desktop, web ou autre) 
qui a fait le buzz! Et tout vas pour le mieux :-). Mais à un moment donné, vous vous rendez compte que votre 
application devrait pouvoir être utilisé pas que quand on est devant un PC. Et là vous commencez à penser à 
une application mobile sur les différentes plateforme star à savoir Android, IOS et Windows phone.</p>

<p>Un autre problème se pose. Comment allez vous faire pour mettre toute la logique de votre killer app dans 
un smartphone! déjà qu’il faudra une version par système d’exploitation, si on doit porter toute la logique 
sur chaque langage de programmation(java, objective-C, C#), bonjour la galère! </p>

<p>Vous l’avez devenez! La solution c’est de garder la logique métier côté serveur et que chaque client
(mobile, web, desktop) fasse des appels quand il a besoin d’une ressource spécifique. Les web services REST 
sont une très bonne alternative pour mettre en place ce genre de technique.  Pas besoin d’une implémentation 
par langage; tous les clients utiliseront le protocole http pour communiquer avec les serveurs. Ce qui simplifie 
grandement les échanges entres les différentes entités. </p>

<p>(La gestion des exceptions et certaines initialisations de variable ont été volontairement omises.) </p>

<h2>Faire un appel</h2>

<p>Pour faire un appel vu que REST est orienté web, on va utiliser les classes du package java.net. On crée un objet 
de type URL qui va contenir l’adresse de la ressource ou tout simplement le lien du service: </p>

<div class="highlight"><pre><code class="java"><span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://chemin/vers/service&quot;</span><span class="o">);</span>
</code></pre></div>

<p>On ouvre une connexion</p>

<div class="highlight"><pre><code class="java"><span class="n">URLConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
<span class="n">HttpURLConnection</span> <span class="n">httpConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">connection</span><span class="o">;</span>
</code></pre></div>

<p>Récupération du code de retour. Vu qu’on est en HTTP. Si tout c’est bien passé on doit recevoir le code 200 (ici HttpURLConnection.HTTP_OK) et enfin récupérer notre flux:</p>

<div class="highlight"><pre><code class="java"><span class="kt">int</span> <span class="n">responseCode</span> <span class="o">=</span> <span class="n">httpConnection</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">responseCode</span> <span class="o">==</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">in</span> <span class="o">=</span> <span class="n">httpConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>

<p>A ce stade nous avons un objet de type InputStream qui contient les informations que le serveur a renvoyé.</p>

<h2>Parser du xml avec XMLPullParser</h2>

<p>Apres la récupération des données il faut bien les lires. 
Pour cela il faudra utiliser un parseur en fonction de la techno utiliser pour envoyer les données côté serveur. 
Dans le cas du xml, il existe un parseur natif intégrer à Android: XMLPullParser. C’est un parseur bas niveau; 
c’est a dire qu’il faudra parcourir tout le document xml, tag par tag et faire des traitements en fonction du tag 
rencontré. Voici un exemple de xml que l’on peut recevoir: </p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;personnes&gt;</span>
   <span class="nt">&lt;personne</span> <span class="na">genre=</span><span class="s">&quot;feminin&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;nom&gt;</span>Diallo<span class="nt">&lt;/nom&gt;</span>
      <span class="nt">&lt;prenom&gt;</span>Binta<span class="nt">&lt;/prenom&gt;</span>
      <span class="nt">&lt;age&gt;</span>15<span class="nt">&lt;/age&gt;</span>
   <span class="nt">&lt;/personne&gt;</span>
   <span class="nt">&lt;personne</span> <span class="na">genre=</span><span class="s">&quot;masculin&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;nom&gt;</span>Ndiaye<span class="nt">&lt;/nom&gt;</span>
      <span class="nt">&lt;prenom&gt;</span>Alioune<span class="nt">&lt;/prenom&gt;</span>
      <span class="nt">&lt;age&gt;</span>25<span class="nt">&lt;/age&gt;</span>
   <span class="nt">&lt;/personne&gt;</span>
<span class="nt">&lt;/personnes&gt;</span>
</code></pre></div>
 

<p>On aura besoin d’un objet String pour contenir la valeur d’un tag à chaque passage., un objet qui va nous 
fournir un parseur qui aura les paramètres indiqués( ici le support des espaces de noms, voir doc de <strong>XmlPullParserFactory</strong>), 
Et enfin générer notre parseur et lui spécifier l’objet InputStream avec lequel il devra travailler: </p>

<div class="highlight"><pre><code class="java"><span class="n">String</span> <span class="n">valeur</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">XmlPullParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">XmlPullParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setNamespaceAware</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">XmlPullParser</span> <span class="n">xpp</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newPullParser</span><span class="o">();</span>
<span class="n">xpp</span><span class="o">.</span><span class="na">setInput</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</code></pre></div>
 

<p>Voici un morceau de code tiré de la doc officiel qu’on peut utiliser pour extraire les informations du InputStream: </p>

<div class="highlight"><pre><code class="java"><span class="c1">//Le type d&#39;evenement pour savoir si on est au debut du xml et bien </span>
<span class="c1">//d&#39;autres informations</span>
<span class="kt">int</span> <span class="n">eventType</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getEventType</span><span class="o">();</span>
<span class="c1">//Tant qu&#39;on n&#39;est pas à la fin du document</span>
<span class="k">while</span> <span class="o">(</span><span class="n">eventType</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_DOCUMENT</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">//Si on est au debut d&#39;un tag</span>
   <span class="k">if</span><span class="o">(</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;personne&quot;</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">genre</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getAttributeValue</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;genre&quot;</span><span class="o">);</span>
      <span class="o">}</span>
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;nom&quot;</span><span class="o">)){</span>
         <span class="n">nom</span> <span class="o">=</span> <span class="n">valeur</span><span class="o">;</span>
         <span class="n">valeur</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span> 
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">eventType</span> <span class="o">==</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">TEXT</span><span class="o">)</span> <span class="o">{</span>
       <span class="c1">//recuperation de la valeur pour le tag actuel</span>
       <span class="n">valeur</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
   <span class="o">}</span>
   <span class="n">eventType</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
 

<p>Une petite astuce que vous avez surement remarqué, en début de tag on récupére les attributs du tag, en fin de 
tag on récupère la valeur pour ce tag. 
Un exemple concret sur ce parseur sur <a href="https://github.com/soulesidibe/xmlPullParserExemple">github</a>. </p>

<h2>Manipuler du json</h2>

<p>Pour traiter du json reçu via un web service, Android embarque en natif un package constituer de classe 
pour faire le job: <strong>org.json.</strong>* .Elles sont très simples d’utilisation. Voyons ce cas pratique de json: </p>

<div class="highlight"><pre><code class="json"><span class="p">{</span>
   <span class="nt">&quot;personnes&quot;</span><span class="p">:[</span>
      <span class="p">{</span>
         <span class="nt">&quot;nom&quot;</span><span class="p">:</span><span class="s2">&quot;Fama&quot;</span><span class="p">,</span>         
         <span class="nt">&quot;prenom&quot;</span><span class="p">:</span><span class="s2">&quot;Mbaye&quot;</span><span class="p">,</span>         
         <span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="s2">&quot;19&quot;</span><span class="p">,</span>        
         <span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="s2">&quot;feminin&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="nt">&quot;nom&quot;</span><span class="p">:</span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span>
         <span class="nt">&quot;prenom&quot;</span><span class="p">:</span><span class="s2">&quot;Anthoine&quot;</span><span class="p">,</span>
         <span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="s2">&quot;30&quot;</span><span class="p">,</span>
         <span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="s2">&quot;masculin&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
 

<p>Le code pour récupérer les informations ci-dessus: </p>

<div class="highlight"><pre><code class="java"><span class="c1">//Convertir le InputStream de départ en String</span>
<span class="n">BufferedReader</span> <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">InputStreamReader</span><span class="o">(</span><span class="n">in</span><span class="o">));</span>
<span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
<span class="n">String</span> <span class="n">uneLigneLue</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
<span class="k">while</span> <span class="o">(</span><span class="n">uneLigneLue</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">//on ajoute la nouvelle ligne lue dans le StringBuilder</span>
   <span class="n">stringBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">UneLigneLue</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>
   <span class="c1">//lecture de la ligne suivante</span>
   <span class="n">ligneLue</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span> 
<span class="o">}</span>
<span class="n">bufferedReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

<span class="c1">//notre Objet maguique</span>
<span class="n">JSONObject</span> <span class="n">object</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">stringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="n">JSONArray</span> <span class="n">array</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">&quot;personnes&quot;</span><span class="o">);</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
    <span class="n">nom</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;nom&quot;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div>
 

<p>Un cas concret de manipulation du json sur <a href="https://github.com/soulesidibe/JsonParserExemple">github</a>. </p>

<p>Cette facon de faire est pratique pour des fichiers aussi simple que celui utilisé mais il est mieux dans 
certains cas d’opter pour des librairies qui ajoutent un niveau d’abstraction dans un souci de simplifier 
la manipulation du json. C’est le cas de la librairie <strong>GSON</strong> qui permet de faire le passage du JSON en <strong>POJO</strong> 
et vice versa.  Il y a aussi la librairie <strong>JACKSON</strong> tout aussi puissante. 
Il faut juste choisir celle qui nous rend efficace. </p>

<h2>Oui mais pourquoi faire?</h2>

<p>Apres avoir reçu les données du serveur, après avoir convertir le xml/json en objet java, en tant que 
dévelopeur java, il n’y a pas vraiment de limite! 
Dans le contexte d’un développement android, il y a plusieurs manières d’utiliser ces données: </p>

<ul>
<li>Mettre à jour une liste: exemple une vue qui affiche la timeline d’un compte twitter a besoin de récupérer 
les informations des serveurs de twitter pour les exposer à l’utilisateur via une ListView ou une ListActivity;</li>
<li>Renseigner une base de données (sqlite) pour une utilisation de l’application en offline </li>
</ul>

<p>Les possibilités n’ont pas de limite. Ça dépendra de ce que l’application fait et de comment 
le développeur veut le faire.</p>

  </div>



<div class="pagination">
  
    <a href="/page6" class="previous">Previous</a>
  
  <span class="page_number ">Page: 7 of 8</span>
  
    <a href="/page8" class="next">Next</a>
  
</div>

-->
        <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'soulesidibe'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
      <div class="footer">
        <p>
          &copy; 2014. All rights reserved.
        </p>
      </div>
    </div>

  </body>
</html>
